<script>
    // Initialize Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyA7nRo1nVCaIg75JOpvh1gPy_kQ3_zQjXY",
        authDomain: "digital-bit-6e599.firebaseapp.com",
        projectId: "digital-bit-6e599",
        storageBucket: "digital-bit-6e599.appspot.com",  // FIXED
        messagingSenderId: "261463383888",
        appId: "1:261463383888:web:c5cf8991d02645e6fb5655"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Get the current user ID from Firebase Authentication
    firebase.auth().onAuthStateChanged((user) => {
        if (user) {
            const userId = user.uid;  // FIXED - Get actual user ID

            // Fetch username
            db.collection("users").doc(userId).get().then((doc) => {
                if (doc.exists) {
                    document.getElementById("username").innerText = doc.data().username;
                } else {
                    console.log("User not found!");
                }
            }).catch((error) => {
                console.error("Error fetching user data:", error);
            });

            // Listen for balance updates
            db.collection("users").doc(userId).onSnapshot((doc) => {
                if (doc.exists) {
                    const balance = doc.data().balance || 0;
                    document.getElementById("balance").innerText = `INR ${balance.toLocaleString()}`;
                } else {
                    console.log("User not found!");
                }
            }, (error) => {
                console.error("Error listening for balance updates:", error);
            });
        } else {
            console.log("No user logged in.");
        }
    });

    // Open Live Chat when any button is clicked
    function openLiveChat() {
        if (window.jivo_api) {
            jivo_api.open();
        } else {
            alert("Live Chat is loading, please try again in a few seconds.");
        }
    }
</script>
